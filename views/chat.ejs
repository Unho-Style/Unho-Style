<!-- we are fucked up -->
<style>
    .root {
        width: 100%;
        height: calc(100vh - 3.5em);
        padding: 10px;
    }

    .selectChat {
        display:block;
        text-align: center;
        margin-top: 10px;
    }

    .productInfo {
        display: flex;
        align-items: center;
        height: 5em;
        background-color: lightgray;
        padding: 10px 0 10px 0;
    }

    .productInfo > div {
        margin-left: 10px;
        /* vertical-align: middle; */
    }

    #productImg {
        aspect-ratio : 1 / 1;
        height: 100%;
        object-fit: cover;
        margin-left: 10px;
        /* margin-top: -10px; */
    }

    #backBtn {
        margin-left: 10px;
        /* vertical-align: middle; */
        text-decoration: none;
    }

    #send {
        width: 100%;
    }

    #buy {
        margin-left: auto;
        margin-right: 10px;
        /* vertical-align: middle; */
    }

    .chat {
        width: 100%;
        height: 100%;
    }

    .chatCard { 
        text-decoration: none;
        margin-bottom: 10px;
    }

    .nochat {
        display:block;
        text-align: center;
        margin-top: 10px;
    }

    .scroll {
        overflow-y: auto;
        height: calc(100% - 8.5em);
    }

    .bubble {
        /* display:block; */
        max-width: 80%;
        width: fit-content;
        margin: 10px;
    }

    .bubbleText {
        display: inline-block;
        max-width: 100%;
        width: fit-content;
        border-radius: 10px;
        border: lightgray solid 1px;
        padding: 10px;
    }

    .timestamp {
        color:rgb(172, 172, 172);
        font-size: 0.8em;
        vertical-align: bottom;
        margin: 0 5px 0 5px;
    }

    .text {
        margin: 10px;
    }

    .right {
        margin-left: auto;
    }

    .hide {
        display:none;
    }
</style>
<%- include('nav') %>
<div class="root">
    <h4 style="margin-bottom: 15px;">채팅 목록</h4>
    <div class="chatlist">
        
    </div>
</div>
<!-- <script src="/socket.io/socket.io.js"></script> -->
<script>
    function loadChatList() {
        $('div.chatList').html('');
        fetch('/api/chat/getChats').then(async res => {
            let data = (await res.json()).data;
            // console.log(data);
            if(!!data?.length) {
                data.forEach((e) => {
                let card = `<a class="card chatCard" href="/message?chatid=${e.chat_id}">
                        <div class="card-body">
                            <h5 class="card-title">${e.username}</h5>
                            <p class="card-text">${e.last_message}</p>
                        </div>
                    </a>`
                    $('div.chatlist').append(card);
                });
            } else {
                $('div.chatlist').append('<span class="nochat">아직 조용하군요..</span>');
            }
        });
    }

    /**
     * @param {Date} date
     */
    function dateToString(date) {
        return `${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;
    }

    $(window).on('load', () => {
        loadChatList();
    })
</script>